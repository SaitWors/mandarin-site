<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mandarin — links</title>
  <meta name="description" content="Все ссылки Mandarin в одном месте" />
  <meta property="og:title" content="Mandarin — links" />
  <meta property="og:description" content="Все ссылки Mandarin в одном месте" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="images/avatar.png" />
  <meta name="theme-color" content="#ff7a00" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='28' fill='%23ff7a00'/><path d='M28 20c6-6 12-6 16-4' stroke='%231b1b1b' stroke-width='4' fill='none' stroke-linecap='round'/></svg>">
  <style>
    :root{
      --bg: #0b0b0f;
      --card: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.12);
      --text: #eaeaf0;
      --muted: #a7a7b3;
      --accent: #ff7a00;
      --accent-2: #ffb46b;
      --radius: 20px;
      --swatch-selected-outline: 2px solid rgba(255,255,255,0.14);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(60vmax 60vmax at 15% 10%, rgba(255,122,0,.12), transparent 60%),
        radial-gradient(50vmax 50vmax at 85% 10%, rgba(255,122,0,.08), transparent 60%),
        linear-gradient(180deg, #0b0b0f 0%, #0a0a0d 100%);
      display:grid; place-items:center;
      padding:24px;
    }
    .wrap{ width:min(720px, 100%); }
    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    }
    .top{ display:flex; gap:18px; align-items:center; }
    .avatar{ width:88px; height:88px; border-radius:22px; overflow:hidden; border:1px solid var(--card-border); background:#111; flex:0 0 auto }
    .avatar img{ width:100%; height:100%; object-fit:cover }
    .id{ flex:1 1 auto }
    .name{ font-size: clamp(22px, 3.4vw, 30px); font-weight: 800; letter-spacing:.2px }
    .bio{ color:var(--muted); margin-top:4px }
    .badges{ margin-top:10px; display:flex; flex-wrap:wrap; gap:8px }
    .badge{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--card-border); background:rgba(255,255,255,.04); font-size:12px; color:#d6d6df }
    .dot{ width:8px; height:8px; border-radius:50%; background:linear-gradient(90deg,var(--accent),var(--accent-2)) }
    .links{ margin-top:20px; display:grid; gap:12px }
    .btn{
      display:flex; align-items:center; gap:12px;
      width:100%;
      padding:14px 16px; border-radius:14px; text-decoration:none; color:var(--text);
      border:1px solid var(--card-border); background:rgba(255,255,255,.03);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      cursor:pointer;
    }
    .btn:hover{ transform: translateY(-1px); background:rgba(255,255,255,.06); border-color: rgba(255,255,255,.22)}
    .btn:active{ transform: translateY(0)}
    .btn .icon{ width:22px; height:22px; display:grid; place-items:center; flex:0 0 22px }
    .btn .right{ margin-left:auto; opacity:.7; font-size:12px }
    .footer{
      margin-top:22px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:12px
    }
    .made{opacity:.8}
    .theme{ display:flex; gap:8px }
    .swatch{ width:22px; height:22px; border-radius:50%; border:1px solid var(--card-border); cursor:pointer; padding:0; display:inline-flex; align-items:center; justify-content:center }
    .swatch[aria-pressed="true"]{ outline: var(--swatch-selected-outline); }

    /* --- Комментарии и авторизация --- */
    .authBtns { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; align-items:center }
    .authInput { padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(0,0,0,0.35); color:var(--text) }
    .comments { margin-top:18px; border-top:1px solid rgba(255,255,255,0.03); padding-top:16px; }
    #commentsList { display:grid; gap:10px; max-height:300px; overflow:auto; padding-right:6px; }
    .commentItem { background:rgba(255,255,255,0.02); padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.02) }
    textarea#commentText { width:100%; min-height:72px; border-radius:10px; padding:10px; margin-top:10px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.04); color:var(--text) }
    .small { color:var(--muted); font-size:12px; margin-top:6px }
    @media (max-width:480px){ .card{ padding:20px } .avatar{ width:76px; height:76px } .authBtns{flex-direction:column; align-items:stretch} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="cardRoot">
      <div class="top">
        <div class="avatar">
          <img id="avatar" alt="аватар" src="images/avatar.png" loading="lazy" decoding="async">
        </div>
        <div class="id">
          <div class="name" id="displayName">Mandarin</div>
          <div class="bio" id="bio">Junior dev • Roblox/Lua & Java • Люблю Steam-игры и делаю утилиты «для себя»</div>
          <div class="badges" id="badges" aria-hidden="false"></div>

          <!-- Блок авторизации: поля + кнопки -->
          <div id="authArea" class="authBtns" aria-live="polite">
            <input id="emailInput" class="authInput" placeholder="Email" type="email" style="min-width:200px">
            <input id="nameInput" class="authInput" placeholder="Имя (опционально)" type="text" style="min-width:140px">
            <input id="passwordInput" class="authInput" placeholder="Пароль" type="password" style="min-width:140px">

            <button id="registerBtn" class="btn" title="Создать аккаунт">Зарегистрироваться</button>
            <button id="loginBtn" class="btn" title="Войти">Войти</button>
            <button id="anonBtn" class="btn" title="Войти анонимно">Войти анонимно</button>

            <button id="logoutBtn" class="btn" style="display:none; background:rgba(255,255,255,0.02)">Выйти</button>
          </div>

          <div id="userMini" style="display:none; margin-top:8px;">
            <span class="small">Вошли как <b id="authName"></b> <span id="anonBadge" style="color:#f4b400; margin-left:8px; display:none">(аноним)</span></span>
          </div>
        </div>
      </div>

      <div class="links" id="links" role="list"></div>

      <!-- Комментарии -->
      <div class="comments" id="commentsSection">
        <h3 style="margin:0 0 8px 0">Комментарии</h3>
        <div id="authHint" class="small">Чтобы оставить комментарий — войдите через Email или используйте анонимный вход.</div>

        <div id="commentsList"></div>

        <textarea id="commentText" placeholder="Напиши комментарий..." aria-label="Комментарий"></textarea>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="sendComment" class="btn">Отправить</button>
          <button id="refreshComments" class="btn" type="button">Обновить</button>
        </div>
      </div>

      <div class="footer">
        <div class="made">© <span id="year"></span> Mandarin</div>
        <div class="theme" id="themePicker" aria-label="Выбор темы"></div>
      </div>
    </div>
  </div>

  <!-- Твой основной скрипт остался (рендер ссылок/тем) -->
  <script>
    'use strict';
    // ======= SVG ИКОНКИ (оставил как у тебя) =======
    const svgDiscord = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;
    const svgGitHub = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.708 2 12.37c0 4.57 2.865 8.438 6.839 9.804.5.098.683-.224.683-.5v-1.96c-2.782.623-3.366-1.37-3.366-1.37-.455-1.196-1.11-1.515-1.11-1.515-.908-.647.07-.634.07-.634 1.003.074 1.53 1.067 1.53 1.067.893 1.574 2.341 1.12 2.91.857.091-.67.35-1.12.636-1.378-2.22-.263-4.555-1.16-4.555-5.161 0-1.14.392-2.07 1.036-2.802-.104-.263-.45-1.324.098-2.758 0 0 .842-.276 2.76 1.07a9.25 9.25 0 0 1 5.024 0c1.918-1.346 2.76-1.07 2.76-1.07.548 1.434.202 2.495.099 2.758.643.732 1.035 1.662 1.035 2.802 0 4.01-2.339 4.894-4.566 5.153.359.326.678.967.678 1.951v2.896c0 .268.18.599.69.497A10.27 10.27 0 0 0 22 12.37C22 6.709 17.523 2 12 2Z" clip-rule="evenodd"/></svg>`;
    const svgSteam = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;
    const svgTelegram = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;
    const svgCube = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;
    const svgYouTube = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;
    const svgTwitch = () => `<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">...</svg>`;

    // ======= CONFIG (твой оригинал) =======
    const CONFIG = {
      name: "Mandarin",
      avatar: "images/avatar.png",
      bio: "Junior dev • Python/Lua & Java • Люблю Garry's Mod • 20 Лет",
      badges: [
        { text: "Тарков", accent: true },
        { text: "Бог Мандарин" },
        { text: "RU/Moscow" },
      ],
      theme: {
        color: "#ff7a00",
        alt: "#ffb46b",
        presets: ["#ff7a00", "#00d1b2", "#6c5ce7", "#00a2ff", "#34d399", "#f43f5e"]
      },
      links: [
        { label: "Roblox Game: Dungeon & Artifacts", href: "https://www.roblox.com/games/73275351338484/In-development-Artefacts-Hunter", sub: "WIP • модульная генерация данжей", icon: svgCube() },
        { label: "GitHub", href: "https://github.com/SaitWors", sub: "код, полезные скрипты", icon: svgGitHub() },
        { label: "Steam", href: "https://steamcommunity.com/id/MandarinCreatorGrup/", sub: "играем в инди и не только", icon: svgSteam() },
        { label: "Discord", href: "https://discord.gg/CAmtazPK", sub: "@mandarin", icon: svgDiscord() },
        { label: "Telegram", href: "https://t.me/MandarinCreatorGroup", sub: "канал/контакт", icon: svgTelegram() },
        { label: "YouTube", href: "https://www.youtube.com/@OttoKrauts", sub: "канал", icon: svgYouTube() },
        { label: "Twitch", href: "https://www.twitch.tv/mandarincg", sub: "стримы", icon: svgTwitch() },
      ]
    };

    // ======= Утилиты (как было) =======
    const el = sel => document.querySelector(sel);

    function normalizeHex(hex){
      if(typeof hex !== 'string') return null;
      hex = hex.trim().toLowerCase();
      if(!hex.startsWith('#')) hex = '#' + hex;
      if(!/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(hex)) return null;
      if(hex.length === 4){
        hex = '#' + hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];
      }
      return hex;
    }

    function lighten(hex, amount){
      const n = normalizeHex(hex);
      if(!n) return '#000000';
      const c = n.slice(1);
      const num = parseInt(c,16);
      let r = (num >> 16) & 0xFF, g = (num >> 8) & 0xFF, b = num & 0xFF;
      r = Math.min(255, Math.round(r + (255 - r) * amount));
      g = Math.min(255, Math.round(g + (255 - g) * amount));
      b = Math.min(255, Math.round(b + (255 - b) * amount));
      const toHex = v => v.toString(16).padStart(2,'0');
      return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
    }

    function applyTheme(color, alt){
      const norm = normalizeHex(color) || '#ff7a00';
      const altNorm = normalizeHex(alt) || lighten(norm, 0.35);
      document.documentElement.style.setProperty('--accent', norm);
      document.documentElement.style.setProperty('--accent-2', altNorm);
      const meta = document.querySelector('meta[name="theme-color"]');
      if(meta) meta.setAttribute('content', norm);
    }

    function render(){
      try {
        el('#displayName').textContent = CONFIG.name || 'Mandarin';
        el('#bio').textContent = CONFIG.bio || '';
        const avatarEl = el('#avatar');
        avatarEl.src = CONFIG.avatar || 'images/avatar.png';
        avatarEl.alt = CONFIG.name ? `${CONFIG.name} — аватар` : 'аватар';

        // бейджи
        const badges = el('#badges');
        badges.innerHTML = '';
        (CONFIG.badges || []).forEach(b => {
          const d = document.createElement('div');
          d.className = 'badge';
          if(b && b.accent){
            const dot = document.createElement('span');
            dot.className = 'dot';
            dot.setAttribute('aria-hidden','true');
            d.appendChild(dot);
            d.appendChild(document.createTextNode(b.text || ''));
          } else {
            d.textContent = b.text || '';
          }
          badges.appendChild(d);
        });

        // ссылки
        const links = el('#links');
        links.innerHTML = '';
        (CONFIG.links || []).forEach(item => {
          const a = document.createElement('a');
          a.className = 'btn';
          a.href = item.href || '#';
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.setAttribute('role','listitem');

          const iconWrap = document.createElement('span');
          iconWrap.className = 'icon';
          if(item.icon && typeof item.icon === 'string'){
            iconWrap.innerHTML = item.icon;
          }

          const label = document.createElement('span');
          label.textContent = item.label || '';

          a.appendChild(iconWrap);
          a.appendChild(label);

          if(item.sub){
            const right = document.createElement('span');
            right.className = 'right';
            right.textContent = item.sub;
            a.appendChild(right);
          }

          links.appendChild(a);
        });

        // темы
        const tp = el('#themePicker');
        tp.innerHTML = '';
        const presets = (CONFIG.theme && CONFIG.theme.presets) ? CONFIG.theme.presets.slice() : ['#ff7a00'];
        presets.forEach((c, idx) => {
          const s = document.createElement('button');
          s.className = 'swatch';
          s.type = 'button';
          const norm = normalizeHex(c) || '#000000';
          s.style.background = norm;
          s.title = norm;
          s.setAttribute('aria-label', `Тема ${norm}`);
          s.setAttribute('aria-pressed', 'false');
          s.dataset.color = norm;
          s.addEventListener('click', () => {
            tp.querySelectorAll('.swatch').forEach(sw => sw.setAttribute('aria-pressed','false'));
            s.setAttribute('aria-pressed','true');
            applyTheme(norm);
          });
          if(idx === 0) s.setAttribute('aria-pressed','true');
          tp.appendChild(s);
        });

        applyTheme(CONFIG.theme.color, CONFIG.theme.alt);
        el('#year').textContent = new Date().getFullYear();
      } catch (err) {
        console.error('Render error:', err);
      }
    }

    render();
  </script>

  <!-- ========== Firebase (Email+Password + Anonymous) + Comments ========== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signInAnonymously,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      serverTimestamp,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ---- ЗАМЕНИ НА СВОИ ДАННЫЕ ----
    const firebaseConfig = {
      apiKey: "AIzaSyD_b_RUXemBYyW3Ot2_8RCA6APCSg4wo-Q",
      authDomain: "mandarincgroupsite.firebaseapp.com",
      projectId: "mandarincgroupsite",
      storageBucket: "mandarincgroupsite.firebasestorage.app",
      messagingSenderId: "1086684215118",
      appId: "1:1086684215118:web:8465e5ace4845ee244101f",
      measurementId: "G-GKT7QMMCDE"
    };
    // ------------------------------

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM
    const emailInput = document.getElementById('emailInput');
    const nameInput = document.getElementById('nameInput');
    const passwordInput = document.getElementById('passwordInput');
    const registerBtn = document.getElementById('registerBtn');
    const loginBtn = document.getElementById('loginBtn');
    const anonBtn = document.getElementById('anonBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const authArea = document.getElementById('authArea');
    const userMini = document.getElementById('userMini');
    const authName = document.getElementById('authName');
    const anonBadge = document.getElementById('anonBadge');
    const avatarImg = document.getElementById('avatar');
    const displayNameEl = document.getElementById('displayName');

    const commentsList = document.getElementById('commentsList');
    const sendBtn = document.getElementById('sendComment');
    const refreshBtn = document.getElementById('refreshComments');
    const commentText = document.getElementById('commentText');
    const authHint = document.getElementById('authHint');

    // Если хочешь запретить анонимам — поставь сюда true. Тогда в UI и в коде анонимы не смогут отправлять.
    const RESTRICT_ANONYMOUS_FROM_POST = false;

    // Регистрация
    registerBtn.addEventListener('click', async () => {
      const email = (emailInput.value || '').trim();
      const pass = (passwordInput.value || '');
      const display = (nameInput.value || '').trim();
      if(!email || !pass) return alert('Введите email и пароль');
      registerBtn.disabled = true;
      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        if(display) {
          await updateProfile(cred.user, { displayName: display });
        }
        // profile auto applied in onAuthStateChanged
      } catch (e) {
        console.error(e);
        alert('Ошибка регистрации: ' + (e.message || e));
      } finally {
        registerBtn.disabled = false;
      }
    });

    // Вход
    loginBtn.addEventListener('click', async () => {
      const email = (emailInput.value || '').trim();
      const pass = (passwordInput.value || '');
      if(!email || !pass) return alert('Введите email и пароль');
      loginBtn.disabled = true;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (e) {
        console.error(e);
        alert('Ошибка входа: ' + (e.message || e));
      } finally {
        loginBtn.disabled = false;
      }
    });

    // Анонимный вход
    anonBtn.addEventListener('click', async () => {
      anonBtn.disabled = true;
      try {
        await signInAnonymously(auth);
      } catch (e) {
        console.error(e);
        alert('Ошибка анонимного входа: ' + (e.message || e));
      } finally {
        anonBtn.disabled = false;
      }
    });

    // Выход
    logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
    });

    // Слушаем авторизацию
    onAuthStateChanged(auth, user => {
      if(user){
        authArea.querySelectorAll('input, button').forEach(el => {
          if(el !== logoutBtn) el.style.display = 'none';
        });
        logoutBtn.style.display = 'inline-flex';
        userMini.style.display = 'block';
        authName.textContent = user.displayName || user.email || ('user:' + user.uid.slice(0,6));
        anonBadge.style.display = user.isAnonymous ? 'inline' : 'none';
        // заменить верхний аватар/имя, если есть
        if(user.photoURL){
          avatarImg.src = user.photoURL;
        }
        displayNameEl.textContent = user.displayName || displayNameEl.textContent;
        authHint.style.display = RESTRICT_ANONYMOUS_FROM_POST && user.isAnonymous ? 'block' : 'none';
        // разрешаем/запрещаем писать
        if(RESTRICT_ANONYMOUS_FROM_POST && user.isAnonymous){
          sendBtn.disabled = true;
        } else {
          sendBtn.disabled = false;
        }
      } else {
        // show inputs/buttons
        authArea.querySelectorAll('input, button').forEach(el => el.style.display = '');
        logoutBtn.style.display = 'none';
        userMini.style.display = 'none';
        anonBadge.style.display = 'none';
        avatarImg.src = 'images/avatar.png';
        displayNameEl.textContent = 'Mandarin';
        sendBtn.disabled = true;
      }
    });

    // Комментарии: realtime
    const commentsQuery = query(collection(db, 'comments'), orderBy('createdAt', 'desc'));
    let unsubscribe = null;

    function escapeHtml(s){
      if(!s) return '';
      return s.replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
    }

    function renderComment(doc){
      const data = doc.data();
      const item = document.createElement('div');
      item.className = 'commentItem';
      const time = data.createdAt && data.createdAt.toDate ? data.createdAt.toDate().toLocaleString() : '';
      item.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
          <div><b>${escapeHtml(data.user || 'Аноним')}</b> <span class="small" style="margin-left:8px">${time}</span></div>
        </div>
        <div style="margin-top:6px">${escapeHtml(data.text)}</div>`;
      return item;
    }

    function startCommentsRealtime(){
      if(unsubscribe) unsubscribe();
      unsubscribe = onSnapshot(commentsQuery, snapshot => {
        commentsList.innerHTML = '';
        snapshot.forEach(doc => {
          const el = renderComment(doc);
          commentsList.appendChild(el);
        });
      }, err => {
        console.error('comments snapshot error', err);
      });
    }

    startCommentsRealtime();

    // Отправка комментария
    sendBtn.addEventListener('click', async () => {
      const user = auth.currentUser;
      if(!user) { alert('Войдите чтобы оставить комментарий'); return; }
      if(RESTRICT_ANONYMOUS_FROM_POST && user.isAnonymous){ alert('Анонимным запрещено отправлять комментарии'); return; }
      const txt = (commentText.value || '').trim();
      if(!txt) return;
      sendBtn.disabled = true;
      try {
        await addDoc(collection(db, 'comments'), {
          user: user.displayName || user.email || ('user:' + user.uid.slice(0,6)),
          uid: user.uid,
          text: txt,
          createdAt: serverTimestamp()
        });
        commentText.value = '';
      } catch (e) {
        console.error(e);
        alert('Ошибка отправки: ' + (e.message || e));
      } finally {
        sendBtn.disabled = false;
      }
    });

    refreshBtn.addEventListener('click', () => {
      startCommentsRealtime();
    });

    // По умолчанию пока не вошли — запретим кнопку
    sendBtn.disabled = true;
  </script>
</body>
</html>
